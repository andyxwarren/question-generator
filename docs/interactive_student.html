<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Maths Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
        }

        .setup-screen, .practice-screen, .results-screen {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .setup-screen h1 {
            color: #667eea;
            font-size: 36px;
            margin-bottom: 10px;
            text-align: center;
        }

        .setup-screen p {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
        }

        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .setup-card {
            background: #f8f9ff;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .setup-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .setup-card.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .setup-card h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .setup-card p {
            font-size: 14px;
            opacity: 0.8;
        }

        .level-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .level-card {
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .level-card.level-1 { background: #d4edda; color: #155724; }
        .level-card.level-2 { background: #d1ecf1; color: #0c5460; }
        .level-card.level-3 { background: #e2d9f3; color: #4a148c; }
        .level-card.level-4 { background: #ffe5cc; color: #833c0c; }

        .level-card:hover {
            transform: scale(1.05);
        }

        .level-card.selected {
            border-color: #333;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .question-count {
            text-align: center;
            margin-bottom: 30px;
        }

        .question-count label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .question-count input {
            width: 100px;
            padding: 10px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 18px;
            text-align: center;
            font-weight: 600;
        }

        .start-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Practice Screen */
        .practice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .progress-info {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
        }

        .score-display {
            display: flex;
            gap: 20px;
        }

        .score-item {
            text-align: center;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
        }

        .score-label {
            font-size: 12px;
            color: #666;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.5s ease;
        }

        .question-card {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .question-number {
            color: #667eea;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .answer-options {
            display: grid;
            gap: 12px;
        }

        .answer-btn {
            padding: 18px 24px;
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .answer-btn:hover:not(:disabled) {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .answer-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .answer-btn.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .answer-btn.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            border: 3px solid #667eea;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .submit-btn:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .next-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        /* Draggable items */
        .drag-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            margin: 15px 0;
            min-height: 80px;
        }

        .draggable-item {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: move;
            font-size: 18px;
            font-weight: 600;
            user-select: none;
            transition: all 0.2s;
        }

        .draggable-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .draggable-item.dragging {
            opacity: 0.5;
        }

        .drop-zone {
            padding: 15px 25px;
            background: #f8f9ff;
            border: 3px dashed #667eea;
            border-radius: 8px;
            min-width: 80px;
            min-height: 55px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: #999;
            margin: 5px;
            transition: all 0.2s;
        }

        .drop-zone.drag-over {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .drop-zone.filled {
            background: #667eea;
            color: white;
            border-style: solid;
        }

        /* Results Screen */
        .results-screen h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 36px;
        }

        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }

        .result-value {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .result-label {
            color: #666;
            font-size: 16px;
        }

        .performance-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .performance-message h2 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .performance-message p {
            font-size: 18px;
            opacity: 0.9;
        }

        .action-btns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .action-btn {
            padding: 15px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .action-btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none;
        }

        .emoji {
            font-size: 64px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Setup Screen -->
        <div class="setup-screen" id="setupScreen">
            <h1>🎓 Maths Practice</h1>
            <p>Choose your topic and difficulty to start practicing!</p>

            <h3 style="margin-bottom: 15px; color: #333;">Choose a Topic:</h3>
            <div class="setup-grid" id="topicGrid"></div>

            <h3 style="margin-bottom: 15px; color: #333;">Choose Difficulty:</h3>
            <div class="level-cards" id="levelCards"></div>

            <div class="question-count">
                <label>Number of Questions:</label>
                <input type="number" id="questionCountInput" min="5" max="20" value="10">
            </div>

            <button class="start-btn" id="startBtn">Start Practice</button>
        </div>

        <!-- Practice Screen -->
        <div class="practice-screen hidden" id="practiceScreen">
            <div class="practice-header">
                <div class="progress-info">
                    Question <span id="currentQ">1</span> of <span id="totalQ">10</span>
                </div>
                <div class="score-display">
                    <div class="score-item">
                        <div class="score-value" id="correctCount">0</div>
                        <div class="score-label">Correct</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value" style="color: #dc3545;" id="incorrectCount">0</div>
                        <div class="score-label">Incorrect</div>
                    </div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="question-card">
                <div class="question-number" id="questionType">Multiple Choice</div>
                <div class="question-text" id="questionText">Loading question...</div>
                <div id="answerArea"></div>
                <div id="feedbackArea"></div>
            </div>
        </div>

        <!-- Results Screen -->
        <div class="results-screen hidden" id="resultsScreen">
            <div class="emoji" style="text-align: center;" id="resultsEmoji">🎉</div>
            <h1>Practice Complete!</h1>
            
            <div class="results-summary">
                <div class="result-card">
                    <div class="result-value" id="finalScore">0</div>
                    <div class="result-label">Score</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="finalCorrect">0</div>
                    <div class="result-label">Correct</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="finalIncorrect">0</div>
                    <div class="result-label">Incorrect</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="finalPercentage">0%</div>
                    <div class="result-label">Percentage</div>
                </div>
            </div>

            <div class="performance-message" id="performanceMessage">
                <h2 id="performanceTitle">Well done!</h2>
                <p id="performanceText">You're making great progress!</p>
            </div>

            <div class="action-btns">
                <button class="action-btn primary" onclick="restartPractice()">Practice Again</button>
                <button class="action-btn secondary" onclick="changeTopic()">Change Topic</button>
            </div>
        </div>
    </div>

    <script>
        const MODULES = {
            'counting': {
                id: 'counting',
                name: 'Counting',
                description: 'Number sequences and patterns',
                params: {
                    max_value: { 1: 30, 2: 50, 3: 100, 4: 200 },
                    step_sizes: { 1: [1, 2, 5, 10], 2: [1, 2, 5, 10], 3: [1, 2, 5, 10], 4: [1, 2, 3, 5, 10] }
                }
            },
            'bonds': {
                id: 'bonds',
                name: 'Number Bonds',
                description: 'Addition and subtraction facts',
                params: {
                    total_value: { 1: [5, 10], 2: [10], 3: [10, 20], 4: [20] }
                }
            },
            'multiply': {
                id: 'multiply',
                name: 'Multiplication',
                description: 'Times tables practice',
                params: {
                    times_tables: { 1: [2, 5, 10], 2: [2, 3, 4, 5], 3: [3, 4, 8], 4: [6, 7, 8, 9] },
                    max_multiplier: { 1: 5, 2: 10, 3: 12, 4: 12 }
                }
            },
            'fractions': {
                id: 'fractions',
                name: 'Fractions',
                description: 'Equivalent fractions',
                params: {
                    denominators: { 1: [2, 4], 2: [2, 3, 4, 5], 3: [2, 3, 4, 5, 6, 8], 4: [2, 3, 4, 5, 6, 7, 8, 9] }
                }
            }
        };

        let selectedModule = null;
        let selectedLevel = 3;
        let questionCount = 10;
        let questions = [];
        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let currentAnswer = null;

        function init() {
            renderTopics();
            renderLevels();
            
            document.getElementById('startBtn').addEventListener('click', startPractice);
        }

        function renderTopics() {
            const grid = document.getElementById('topicGrid');
            grid.innerHTML = Object.values(MODULES).map(m => `
                <div class="setup-card" onclick="selectTopic('${m.id}')">
                    <h3>${m.name}</h3>
                    <p>${m.description}</p>
                </div>
            `).join('');
        }

        function renderLevels() {
            const grid = document.getElementById('levelCards');
            const levels = [
                { num: 1, name: 'Beginning' },
                { num: 2, name: 'Developing' },
                { num: 3, name: 'Meeting' },
                { num: 4, name: 'Exceeding' }
            ];
            
            grid.innerHTML = levels.map(l => `
                <div class="level-card level-${l.num} ${l.num === 3 ? 'selected' : ''}" onclick="selectLevel(${l.num})">
                    <div>Level ${l.num}</div>
                    <div style="font-size: 12px; margin-top: 5px;">${l.name}</div>
                </div>
            `).join('');
        }

        function selectTopic(moduleId) {
            selectedModule = moduleId;
            document.querySelectorAll('.setup-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.setup-card').classList.add('selected');
        }

        function selectLevel(level) {
            selectedLevel = level;
            document.querySelectorAll('.level-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        function startPractice() {
            if (!selectedModule) {
                alert('Please select a topic!');
                return;
            }

            questionCount = parseInt(document.getElementById('questionCountInput').value);
            generateQuestions();
            
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('practiceScreen').classList.remove('hidden');
            
            currentQuestionIndex = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            
            updateProgress();
            showQuestion();
        }

        function generateQuestions() {
            questions = [];
            const module = MODULES[selectedModule];
            
            for (let i = 0; i < questionCount; i++) {
                const question = generateQuestion(module, selectedLevel);
                if (question) questions.push(question);
            }
        }

        function generateQuestion(module, level) {
            const params = module.params;

            if (module.id === 'counting') {
                const steps = params.step_sizes[level];
                const step = steps[Math.floor(Math.random() * steps.length)];
                const maxVal = params.max_value[level];
                const direction = Math.random() > 0.5 ? 'forwards' : 'backwards';
                
                let start = Math.floor(Math.random() * (maxVal / 2));
                start = Math.floor(start / step) * step;
                
                const sequence = [];
                for (let j = 0; j < 6; j++) {
                    sequence.push(direction === 'forwards' ? start + (j * step) : start - (j * step));
                }

                const types = ['fill_blank', 'multiple_choice', 'next_number'];
                const type = types[Math.floor(Math.random() * types.length)];

                if (type === 'multiple_choice') {
                    const options = [
                        sequence[4],
                        sequence[4] + step,
                        sequence[4] - step,
                        sequence[4] + 2 * step
                    ].sort(() => Math.random() - 0.5);

                    return {
                        text: `What comes next? ${sequence.slice(0, 4).join(', ')}, ...`,
                        type: 'multiple_choice',
                        options: options,
                        answer: sequence[4].toString()
                    };
                } else {
                    return {
                        text: `Fill in the missing number: ${sequence[0]}, ${sequence[1]}, ___, ${sequence[3]}`,
                        type: 'text_input',
                        answer: sequence[2].toString()
                    };
                }
            }

            else if (module.id === 'bonds') {
                const totals = params.total_value[level];
                const total = totals[Math.floor(Math.random() * totals.length)];
                const part1 = Math.floor(Math.random() * (total + 1));
                const part2 = total - part1;

                const types = ['addition', 'subtraction', 'multiple_choice'];
                const type = types[Math.floor(Math.random() * types.length)];

                if (type === 'multiple_choice') {
                    const options = [part2, part2 + 1, part2 - 1, total - part1 - 2].filter(n => n >= 0);
                    while (options.length < 4) options.push(Math.floor(Math.random() * total));
                    
                    return {
                        text: `${part1} + ? = ${total}`,
                        type: 'multiple_choice',
                        options: [...new Set(options)].sort(() => Math.random() - 0.5).slice(0, 4),
                        answer: part2.toString()
                    };
                } else if (type === 'subtraction') {
                    return {
                        text: `${total} - ${part1} = ?`,
                        type: 'text_input',
                        answer: part2.toString()
                    };
                } else {
                    return {
                        text: `${part1} + ? = ${total}`,
                        type: 'text_input',
                        answer: part2.toString()
                    };
                }
            }

            else if (module.id === 'multiply') {
                const tables = params.times_tables[level];
                const table = tables[Math.floor(Math.random() * tables.length)];
                const multiplier = Math.floor(Math.random() * params.max_multiplier[level]) + 1;
                const product = table * multiplier;

                const types = ['standard', 'multiple_choice', 'division'];
                const type = types[Math.floor(Math.random() * types.length)];

                if (type === 'multiple_choice') {
                    const options = [
                        product,
                        product + table,
                        product - table,
                        table + multiplier
                    ].sort(() => Math.random() - 0.5);

                    return {
                        text: `${table} × ${multiplier} = ?`,
                        type: 'multiple_choice',
                        options: options,
                        answer: product.toString()
                    };
                } else if (type === 'division') {
                    return {
                        text: `${product} ÷ ${table} = ?`,
                        type: 'text_input',
                        answer: multiplier.toString()
                    };
                } else {
                    return {
                        text: `${table} × ${multiplier} = ?`,
                        type: 'text_input',
                        answer: product.toString()
                    };
                }
            }

            else if (module.id === 'fractions') {
                const denoms = params.denominators[level];
                const denom1 = denoms[Math.floor(Math.random() * denoms.length)];
                const multiplier = Math.floor(Math.random() * 3) + 2;
                const denom2 = denom1 * multiplier;
                const num1 = Math.floor(Math.random() * denom1) + 1;
                const num2 = num1 * multiplier;

                const types = ['fill_blank', 'multiple_choice'];
                const type = types[Math.floor(Math.random() * types.length)];

                if (type === 'multiple_choice') {
                    const options = [
                        `${num2}/${denom2}`,
                        `${num2 + 1}/${denom2}`,
                        `${num2}/${denom2 + 1}`,
                        `${num1}/${denom2}`
                    ].sort(() => Math.random() - 0.5);

                    return {
                        text: `Which fraction equals ${num1}/${denom1}?`,
                        type: 'multiple_choice',
                        options: options,
                        answer: `${num2}/${denom2}`
                    };
                } else {
                    return {
                        text: `${num1}/${denom1} = ?/${denom2}`,
                        type: 'text_input',
                        answer: num2.toString(),
                        hint: `Type just the numerator (top number)`
                    };
                }
            }

            return null;
        }

        function showQuestion() {
            const question = questions[currentQuestionIndex];
            currentAnswer = null;
            
            document.getElementById('questionType').textContent = question.type === 'multiple_choice' ? 'Multiple Choice' : 'Type Your Answer';
            document.getElementById('questionText').textContent = question.text;
            document.getElementById('feedbackArea').innerHTML = '';

            const answerArea = document.getElementById('answerArea');
            
            if (question.type === 'multiple_choice') {
                answerArea.innerHTML = `
                    <div class="answer-options">
                        ${question.options.map(opt => `
                            <button class="answer-btn" onclick="selectAnswer('${opt}')">${opt}</button>
                        `).join('')}
                    </div>
                `;
            } else {
                answerArea.innerHTML = `
                    <input type="text" class="text-input" id="textAnswer" placeholder="Type your answer here">
                    <button class="submit-btn" onclick="submitTextAnswer()">Submit Answer</button>
                    ${question.hint ? `<p style="margin-top: 10px; color: #666; font-style: italic;">💡 ${question.hint}</p>` : ''}
                `;
                
                document.getElementById('textAnswer').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') submitTextAnswer();
                });
            }
        }

        function selectAnswer(answer) {
            currentAnswer = answer;
            checkAnswer();
        }

        function submitTextAnswer() {
            const input = document.getElementById('textAnswer');
            currentAnswer = input.value.trim();
            
            if (!currentAnswer) {
                alert('Please enter an answer!');
                return;
            }
            
            input.disabled = true;
            document.querySelector('.submit-btn').disabled = true;
            checkAnswer();
        }

        function checkAnswer() {
            const question = questions[currentQuestionIndex];
            const isCorrect = currentAnswer === question.answer;
            
            if (isCorrect) {
                correctAnswers++;
                showFeedback(true, question.answer);
            } else {
                incorrectAnswers++;
                showFeedback(false, question.answer);
            }

            updateProgress();
            
            // Disable all answer buttons
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === question.answer) {
                    btn.classList.add('correct');
                } else if (btn.textContent === currentAnswer) {
                    btn.classList.add('incorrect');
                }
            });
        }

        function showFeedback(isCorrect, correctAnswer) {
            const feedbackArea = document.getElementById('feedbackArea');
            
            if (isCorrect) {
                feedbackArea.innerHTML = `
                    <div class="feedback correct">
                        ✓ Correct! Well done!
                    </div>
                    <button class="next-btn" onclick="nextQuestion()">Next Question →</button>
                `;
            } else {
                feedbackArea.innerHTML = `
                    <div class="feedback incorrect">
                        ✗ Not quite. The correct answer is: ${correctAnswer}
                    </div>
                    <button class="next-btn" onclick="nextQuestion()">Next Question →</button>
                `;
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= questions.length) {
                showResults();
            } else {
                showQuestion();
            }
        }

        function updateProgress() {
            document.getElementById('currentQ').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQ').textContent = questions.length;
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('incorrectCount').textContent = incorrectAnswers;
            
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showResults() {
            document.getElementById('practiceScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            const percentage = Math.round((correctAnswers / questions.length) * 100);
            
            document.getElementById('finalScore').textContent = `${correctAnswers}/${questions.length}`;
            document.getElementById('finalCorrect').textContent = correctAnswers;
            document.getElementById('finalIncorrect').textContent = incorrectAnswers;
            document.getElementById('finalPercentage').textContent = percentage + '%';
            
            let emoji, title, text;
            
            if (percentage >= 90) {
                emoji = '🌟';
                title = 'Outstanding!';
                text = 'You\'re a maths superstar! Keep up the excellent work!';
            } else if (percentage >= 70) {
                emoji = '🎉';
                title = 'Great Job!';
                text = 'You\'re doing really well! Keep practicing!';
            } else if (percentage >= 50) {
                emoji = '👍';
                title = 'Good Effort!';
                text = 'You\'re making progress! Try again to improve your score!';
            } else {
                emoji = '💪';
                title = 'Keep Trying!';
                text = 'Practice makes perfect! Have another go!';
            }
            
            document.getElementById('resultsEmoji').textContent = emoji;
            document.getElementById('performanceTitle').textContent = title;
            document.getElementById('performanceText').textContent = text;
        }

        function restartPractice() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('practiceScreen').classList.remove('hidden');
            
            currentQuestionIndex = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            
            generateQuestions();
            updateProgress();
            showQuestion();
        }

        function changeTopic() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
            
            selectedModule = null;
            document.querySelectorAll('.setup-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        init();
    </script>
</body>
</html>